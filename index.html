<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <title>VideoQuiz Inclusive - –ü–æ–¥–∫—Ä–µ–ø–∞ –∑–∞ –°–û–ü</title>
    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; transition: background-color 0.3s, color 0.3s; overscroll-behavior: none; }
        .sop-high-contrast { background-color: #000 !important; color: #fff !important; }
        .sop-high-contrast .bg-white { background-color: #111 !important; color: #fff !important; border: 2px solid #fff !important; }
        .sop-high-contrast button { border: 2px solid #fff !important; }
        .sop-soft { background-color: #f0f4f8 !important; }
        .sop-soft .bg-blue-600 { background-color: #748cab !important; }
        .big-font { font-size: 125% !important; }
        .animate-bounce-short { animation: bounce 0.5s ease-in-out 2; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Drag and Drop utilities */
        .touch-none { touch-action: none; }
        .select-none { user-select: none; -webkit-user-select: none; }
        
        /* Hide scrollbar */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, forwardRef, useImperativeHandle } = React;

        const speak = (text) => {
            if (!window.speechSynthesis) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'bg-BG';
            utterance.rate = 0.85;
            window.speechSynthesis.speak(utterance);
        };

        const Icons = {
            Speaker: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path></svg>,
            Settings: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
            Check: () => <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="green" strokeWidth="3"><polyline points="20 6 9 17 4 12"></polyline></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="red" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
            Star: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" className={className} stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>,
            Clock: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>,
            Trash: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18m-2 0v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path></svg>,
            Video: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m22 8-6 4 6 4V8Z"></path><rect width="14" height="12" x="2" y="6" rx="2"></rect></svg>,
            Move: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="5 9 2 12 5 15"></polyline><polyline points="9 5 12 2 15 5"></polyline><polyline points="19 9 22 12 19 15"></polyline><polyline points="15 19 12 22 9 19"></polyline><line x1="2" y1="12" x2="22" y2="12"></line><line x1="12" y1="2" x2="12" y2="22"></line></svg>
        };

        const isImageUrl = (str) => typeof str === 'string' && (str.startsWith('http') || str.match(/\.(jpeg|jpg|gif|png)$/) != null);

        // ================= –ú–ï–î–ò–ê –ü–õ–ï–ô–™–† =================
        const MediaPlayer = forwardRef(({ url, onReady }, ref) => {
            const ytPlayerRef = useRef(null);
            const videoRef = useRef(null);
            const [isYt, setIsYt] = useState(false);
            const containerRef = useRef(null);

            useEffect(() => {
                if (!window.YT) {
                    const tag = document.createElement('script');
                    tag.src = "https://www.youtube.com/iframe_api";
                    const firstScriptTag = document.getElementsByTagName('script')[0];
                    if (firstScriptTag && firstScriptTag.parentNode) {
                        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
                    } else {
                        document.head.appendChild(tag);
                    }
                }
            }, []);

            useEffect(() => {
                const ytIdMatch = url ? url.match(/(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([^&?]{11})/) : null;
                const ytId = ytIdMatch ? ytIdMatch[1] : null;
                setIsYt(!!ytId);

                if (ytId) {
                    const setupPlayer = () => {
                        if (window.YT && window.YT.Player) {
                            if (ytPlayerRef.current && typeof ytPlayerRef.current.loadVideoById === 'function') {
                                ytPlayerRef.current.loadVideoById(ytId);
                                if (onReady) onReady();
                            } else {
                                if (containerRef.current) {
                                    containerRef.current.innerHTML = '<div id="yt-player-target" class="w-full h-full"></div>';
                                    ytPlayerRef.current = new window.YT.Player('yt-player-target', {
                                        videoId: ytId,
                                        playerVars: { 'playsinline': 1, 'modestbranding': 1, 'rel': 0 },
                                        events: { onReady: () => { if(onReady) onReady(); } }
                                    });
                                }
                            }
                        } else {
                            setTimeout(setupPlayer, 300);
                        }
                    };
                    setupPlayer();
                } else if (ytPlayerRef.current && typeof ytPlayerRef.current.pauseVideo === 'function') {
                    ytPlayerRef.current.pauseVideo();
                }
            }, [url]);

            useImperativeHandle(ref, () => ({
                play: () => isYt ? ytPlayerRef.current?.playVideo() : videoRef.current?.play(),
                pause: () => isYt ? ytPlayerRef.current?.pauseVideo() : videoRef.current?.pause(),
                getTime: () => {
                    if (isYt && ytPlayerRef.current?.getCurrentTime) return ytPlayerRef.current.getCurrentTime();
                    return videoRef.current?.currentTime || 0;
                }
            }));

            return (
                <div className="w-full h-full relative bg-black">
                    <div ref={containerRef} className={`w-full h-full ${isYt ? 'block' : 'hidden'}`}></div>
                    {!isYt && url && (
                        <video ref={videoRef} src={url} className="w-full h-full object-contain" controls onLoadedMetadata={onReady} />
                    )}
                    {!url && (
                        <div className="absolute inset-0 flex flex-col items-center justify-center text-slate-500 bg-slate-100 z-10 border-4 border-white rounded-xl shadow-inner">
                            <Icons.Video />
                            <p className="mt-2 font-bold text-center px-4">–û—á–∞–∫–≤–∞ —Å–µ YouTube –ª–∏–Ω–∫<br/><span className="text-xs font-normal">–∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–µ–Ω mp4 —Ñ–∞–π–ª</span></p>
                        </div>
                    )}
                </div>
            );
        });

        // ================= DRAG AND DROP –ö–û–ú–ü–û–ù–ï–ù–¢–ò (–£–ß–ï–ù–ò–ö) =================
        const DraggableStudentLabel = ({ labelText, onCorrectDrop }) => {
            const [pos, setPos] = useState({ x: 0, y: 0 });
            const [isDragging, setIsDragging] = useState(false);
            const [isPlaced, setIsPlaced] = useState(false);
            const initPos = useRef({ x: 0, y: 0 });

            const onPointerDown = (e) => {
                if (isPlaced) return;
                setIsDragging(true);
                e.target.setPointerCapture(e.pointerId);
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                initPos.current = { x: clientX - pos.x, y: clientY - pos.y };
                speak(labelText); // –ü—Ä–æ—á–∏—Ç–∞–º–µ –≥–æ –ø—Ä–∏ —Ö–≤–∞—â–∞–Ω–µ
            };

            const onPointerMove = (e) => {
                if (!isDragging) return;
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                setPos({ x: clientX - initPos.current.x, y: clientY - initPos.current.y });
            };

            const onPointerUp = (e) => {
                if (!isDragging) return;
                setIsDragging(false);
                const clientX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
                const clientY = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ —Å–º–µ –ø—É—Å–Ω–∞–ª–∏ –≤—ä—Ä—Ö—É –ø—Ä–∞–≤–∏–ª–Ω–∞ –∑–æ–Ω–∞, –∫–æ—è—Ç–æ –æ—á–∞–∫–≤–∞ –¢–û–ó–ò —Ç–µ–∫—Å—Ç
                const elementsUnderPoint = document.elementsFromPoint(clientX, clientY);
                const zoneElement = elementsUnderPoint.find(el => el.hasAttribute('data-expected-text'));

                if (zoneElement) {
                    const expectedText = zoneElement.getAttribute('data-expected-text');
                    if (expectedText === labelText) {
                        // –ü–æ–∑–Ω–∞—Ö–º–µ!
                        setIsPlaced(true);
                        onCorrectDrop(zoneElement.getAttribute('data-zone-id'));
                        return;
                    }
                }
                
                // –ì—Ä–µ—à–∫–∞ –∏–ª–∏ –ø—É—Å–Ω–∞—Ç–æ –Ω–∏–∫—ä–¥–µ -> –≤—Ä—ä—â–∞–º–µ –≤ –Ω–∞—á–∞–ª–æ—Ç–æ
                speak("–û–ø–∏—Ç–∞–π –Ω–∞ –¥—Ä—É–≥–æ –º—è—Å—Ç–æ");
                setPos({ x: 0, y: 0 });
            };

            if (isPlaced) return null; // –°–∫—Ä–∏–≤–∞–º–µ –≥–æ –æ—Ç —Ç–∞–±–ª–∞—Ç–∞, –∞–∫–æ –≤–µ—á–µ –µ —Å–ª–æ–∂–µ–Ω

            return (
                <div
                    onPointerDown={onPointerDown}
                    onPointerMove={onPointerMove}
                    onPointerUp={onPointerUp}
                    onPointerCancel={onPointerUp}
                    className={`px-6 py-4 bg-white border-4 border-blue-400 text-blue-800 font-bold rounded-2xl shadow-lg touch-none select-none cursor-grab text-xl sm:text-2xl 
                               ${isDragging ? 'z-50 scale-110 shadow-2xl opacity-90 cursor-grabbing bg-blue-50' : 'z-40 transition-transform hover:scale-105'}`}
                    style={{ transform: `translate(${pos.x}px, ${pos.y}px)` }}
                >
                    {isImageUrl(labelText) ? (
                        <img src={labelText} className="h-16 w-16 sm:h-20 sm:w-20 object-contain pointer-events-none" alt="–æ–ø—Ü–∏—è" />
                    ) : (
                        labelText
                    )}
                </div>
            );
        };

        const LabelTaskOverlay = ({ question, onComplete }) => {
            const [placedZones, setPlacedZones] = useState([]);
            const [shuffledLabels, setShuffledLabels] = useState([]);

            useEffect(() => {
                const labels = question.dropZones.map(z => z.text);
                setShuffledLabels(labels.sort(() => Math.random() - 0.5));
                setPlacedZones([]);
            }, [question]);

            const handleCorrectDrop = (zoneId) => {
                const newPlaced = [...placedZones, zoneId];
                setPlacedZones(newPlaced);
                speak("–¢–æ—á–Ω–æ —Ç–∞–∫–∞!");
                if (newPlaced.length === question.dropZones.length) {
                    setTimeout(() => onComplete(true), 1500); 
                }
            };

            return (
                <div className="absolute inset-0 bg-black/40 flex flex-col z-40 animate-fade-in touch-none">
                    <div className="relative flex-1">
                        {question.dropZones.map(zone => {
                            const isZonePlaced = placedZones.includes(zone.id.toString());
                            return (
                                <div 
                                    key={zone.id}
                                    data-zone-id={zone.id}
                                    data-expected-text={zone.text}
                                    className={`absolute px-6 py-4 rounded-2xl text-xl font-bold flex items-center justify-center transform -translate-x-1/2 -translate-y-1/2 transition-colors duration-300
                                               ${isZonePlaced ? 'bg-green-100 border-4 border-green-500 text-green-700 shadow-lg scale-110' : 'bg-white/80 border-4 border-dashed border-slate-600 text-slate-400 shadow-inner'}`}
                                    style={{ left: `${zone.x}%`, top: `${zone.y}%`, minWidth: '120px', minHeight: '60px' }}
                                >
                                    {isZonePlaced ? (
                                        isImageUrl(zone.text) ? <img src={zone.text} className="h-12 object-contain" /> : zone.text
                                    ) : "?"}
                                </div>
                            );
                        })}
                    </div>
                    <div className="bg-slate-100/95 backdrop-blur-md p-6 border-t-4 border-white flex flex-wrap justify-center gap-4 shadow-[0_-10px_30px_rgba(0,0,0,0.1)]">
                        <div className="w-full text-center text-sm font-bold text-slate-500 mb-2 uppercase tracking-widest">–ò–∑—Ç–µ–≥–ª–∏ –¥–æ –ø—Ä–∞–≤–∏–ª–Ω–æ—Ç–æ –º—è—Å—Ç–æ</div>
                        {shuffledLabels.map((text, i) => (
                            <DraggableStudentLabel key={i} labelText={text} onCorrectDrop={handleCorrectDrop} />
                        ))}
                    </div>
                </div>
            );
        };

        const SequenceTaskOverlay = ({ question, onComplete }) => {
            const [placedIndices, setPlacedIndices] = useState([]);
            const [shuffledItems, setShuffledItems] = useState([]);

            useEffect(() => {
                setShuffledItems([...question.items].sort(() => Math.random() - 0.5));
                setPlacedIndices([]);
            }, [question]);

            const handleCorrectDrop = (zoneId) => {
                const index = parseInt(zoneId);
                const newPlaced = [...placedIndices, index];
                setPlacedIndices(newPlaced);
                speak("–¢–æ—á–Ω–æ —Ç–∞–∫–∞!");
                if (newPlaced.length === question.items.length) {
                    setTimeout(() => onComplete(true), 1500);
                }
            };

            return (
                <div className="absolute inset-0 bg-black/40 flex flex-col z-40 animate-fade-in touch-none">
                    <div className="relative flex-1 flex items-center justify-center p-4">
                        <div className="flex flex-wrap sm:flex-nowrap gap-4 justify-center items-center w-full max-w-4xl bg-white/95 p-6 sm:p-8 rounded-3xl shadow-xl">
                            {question.items.map((item, index) => {
                                const isPlaced = placedIndices.includes(index);
                                return (
                                    <div key={index} className="flex flex-col items-center gap-3 w-32 sm:w-40 relative group">
                                        <div className="w-10 h-10 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center font-black text-xl shadow-inner border-2 border-blue-200 shrink-0">
                                            {index + 1}
                                        </div>
                                        <div 
                                            data-zone-id={index}
                                            data-expected-text={item}
                                            className={`w-full aspect-square rounded-2xl border-4 flex items-center justify-center text-center font-bold p-3 transition-all duration-300
                                                ${isPlaced ? 'bg-green-100 border-green-500 text-green-800 scale-105 shadow-lg' : 'bg-slate-100 border-dashed border-slate-300 text-slate-400 shadow-inner'}`}
                                        >
                                            {isPlaced ? (isImageUrl(item) ? <img src={item} className="max-w-full max-h-full object-contain pointer-events-none" /> : <span className="text-xl sm:text-2xl">{item}</span>) : <span className="text-4xl opacity-20">?</span>}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    <div className="bg-slate-100/95 backdrop-blur-md p-6 border-t-4 border-white flex flex-wrap justify-center gap-4 shadow-[0_-10px_30px_rgba(0,0,0,0.1)]">
                        <div className="w-full text-center text-sm font-bold text-slate-500 mb-2 uppercase tracking-widest">–ü–æ–¥—Ä–µ–¥–∏ –ø–æ —Ä–µ–¥ (–ò–∑—Ç–µ–≥–ª–∏)</div>
                        {shuffledItems.map((text, i) => (
                            <DraggableStudentLabel key={i} labelText={text} onCorrectDrop={handleCorrectDrop} />
                        ))}
                    </div>
                </div>
            );
        }

        // ================= DRAG AND DROP –ó–û–ù–ê (–£–ß–ò–¢–ï–õ) =================
        const DraggableTeacherZone = ({ zone, onUpdate, videoContainerRef }) => {
            const handlePointerDown = (e) => {
                e.stopPropagation();
                e.target.setPointerCapture(e.pointerId);
                const startX = e.clientX;
                const startY = e.clientY;
                const startZoneX = zone.x;
                const startZoneY = zone.y;

                const onMove = (moveEvent) => {
                    if (!videoContainerRef.current) return;
                    const rect = videoContainerRef.current.getBoundingClientRect();
                    const dx = ((moveEvent.clientX - startX) / rect.width) * 100;
                    const dy = ((moveEvent.clientY - startY) / rect.height) * 100;
                    let newX = Math.max(5, Math.min(95, startZoneX + dx));
                    let newY = Math.max(5, Math.min(95, startZoneY + dy));
                    onUpdate({ ...zone, x: newX, y: newY });
                };

                const onUp = (upEvent) => {
                    upEvent.target.releasePointerCapture(upEvent.pointerId);
                    window.removeEventListener('pointermove', onMove);
                    window.removeEventListener('pointerup', onUp);
                };

                window.addEventListener('pointermove', onMove);
                window.addEventListener('pointerup', onUp);
            };

            return (
                <div 
                    onPointerDown={handlePointerDown}
                    className="absolute bg-white/90 border-2 border-blue-600 rounded-xl px-4 py-2 font-bold text-sm text-slate-800 shadow-lg cursor-move flex items-center gap-2 touch-none select-none transform -translate-x-1/2 -translate-y-1/2 hover:scale-105 transition-transform ring-4 ring-blue-500/30"
                    style={{ left: `${zone.x}%`, top: `${zone.y}%` }}
                >
                    <Icons.Move /> 
                    {isImageUrl(zone.text) ? 'üì∑ –ö–∞—Ä—Ç–∏–Ω–∫–∞' : (zone.text || '–ü—Ä–∞–∑–Ω–æ –ø–æ–ª–µ')}
                </div>
            );
        };

        // ================= –ì–õ–ê–í–ù–û –ü–†–ò–õ–û–ñ–ï–ù–ò–ï =================
        const App = () => {
            const [view, setView] = useState('student');
            const [videoUrl, setVideoUrl] = useState('');
            const [questions, setQuestions] = useState([]);
            const [activeQ, setActiveQ] = useState(null);
            const [feedback, setFeedback] = useState(null);
            const [theme, setTheme] = useState('default');
            const [fontSize, setFontSize] = useState('normal');
            const [isAuth, setIsAuth] = useState(false);
            const [pass, setPass] = useState('');
            const [playerIsReady, setPlayerIsReady] = useState(false);
            
            const [wrongAttempts, setWrongAttempts] = useState([]);
            const [answeredCount, setAnsweredCount] = useState(0);
            const [isProcessing, setIsProcessing] = useState(false);
            
            const [editLabelModeId, setEditLabelModeId] = useState(null);

            const playerRef = useRef(null);
            const teacherPlayerRef = useRef(null);
            const teacherVideoContainerRef = useRef(null);
            const fileInputRef = useRef(null);

            // –ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Ç–µ—Å—Ç–∞ –æ—Ç —Å–ø–æ–¥–µ–ª–µ–Ω –ª–∏–Ω–∫
            useEffect(() => {
                const hash = window.location.hash.substring(1);
                if (hash) {
                    try {
                        const decompressed = window.LZString ? window.LZString.decompressFromEncodedURIComponent(hash) : null;
                        if (decompressed) {
                            const data = JSON.parse(decompressed);
                            if (data.videoUrl) setVideoUrl(data.videoUrl);
                            if (data.questions) setQuestions(data.questions);
                            setView('student');
                        }
                    } catch (e) { console.error("–ù–µ–≤–∞–ª–∏–¥–µ–Ω –ª–∏–Ω–∫", e); }
                }
            }, []);

            const handleCopyLink = () => {
                if (!window.LZString) return alert("–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∫–æ–º–ø—Ä–µ—Å–∏—è.");
                const data = { videoUrl, questions };
                const compressed = window.LZString.compressToEncodedURIComponent(JSON.stringify(data));
                const link = `${window.location.origin}${window.location.pathname}#${compressed}`;
                
                // –ò–∑–ø–æ–ª–∑–≤–∞–º–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª–µ–Ω –º–µ—Ç–æ–¥ –∑–∞ –∫–æ–ø–∏—Ä–∞–Ω–µ, –∫–æ–π—Ç–æ —Ä–∞–±–æ—Ç–∏ –¥–æ—Ä–∏ –≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏ –ø—Ä–æ–∑–æ—Ä—Ü–∏
                try {
                    const textArea = document.createElement("textarea");
                    textArea.value = link;
                    textArea.style.position = "fixed";  // –ü—Ä–µ–¥–ø–∞–∑–≤–∞ –æ—Ç —Å–∫—Ä–æ–ª–∏—Ä–∞–Ω–µ
                    textArea.style.opacity = "0";
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    if (successful) {
                        alert("‚úÖ –õ–∏–Ω–∫—ä—Ç –µ –∫–æ–ø–∏—Ä–∞–Ω! –ò–∑–ø—Ä–∞—Ç–µ—Ç–µ –≥–æ –Ω–∞ —É—á–µ–Ω–∏–∫–∞.");
                    } else {
                        alert("‚ö†Ô∏è –ù–µ—É—Å–ø–µ—à–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫–æ–ø–∏—Ä–∞–Ω–µ.");
                    }
                } catch (err) {
                    alert("‚ö†Ô∏è –í—ä–∑–Ω–∏–∫–Ω–∞ –≥—Ä–µ—à–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–∞–Ω–µ—Ç–æ.");
                }
            };

            const handleExport = () => {
                const data = { videoUrl, questions };
                const jsonString = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonString], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `videoquiz_urok_${new Date().getTime()}.json`;
                link.click();
                URL.revokeObjectURL(url);
            };

            const handleImport = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.videoUrl !== undefined && Array.isArray(data.questions)) {
                            setVideoUrl(data.videoUrl);
                            setQuestions(data.questions);
                            alert("‚úÖ –£—Ä–æ–∫—ä—Ç –µ –∑–∞—Ä–µ–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ!");
                        } else { alert("‚ö†Ô∏è –ù–µ–≤–∞–ª–∏–¥–µ–Ω —Ñ–æ—Ä–º–∞—Ç –Ω–∞ —Ñ–∞–π–ª–∞."); }
                    } catch (error) { alert("‚ö†Ô∏è –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —á–µ—Ç–µ–Ω–µ –Ω–∞ —Ñ–∞–π–ª–∞."); }
                    if (fileInputRef.current) fileInputRef.current.value = "";
                };
                reader.readAsText(file);
            };

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –≤–∏–¥–µ–æ—Ç–æ (–£—á–µ–Ω–∏–∫)
            useEffect(() => {
                const interval = setInterval(() => {
                    if (view === 'student' && playerRef.current && !activeQ && !feedback) {
                        const time = Math.floor(playerRef.current.getTime());
                        const q = questions.find(q => q.time === time);
                        if (q && !wrongAttempts.length && !isProcessing) {
                            playerRef.current.pause();
                            setActiveQ(q);
                            if (q.type === 'label' || q.type === 'sequence') {
                                speak(q.text);
                            } else {
                                speak(q.text);
                            }
                        }
                    }
                }, 1000);
                return () => clearInterval(interval);
            }, [questions, activeQ, feedback, view, wrongAttempts, isProcessing]);

            const captureTime = (idx) => {
                if (teacherPlayerRef.current) {
                    const time = Math.floor(teacherPlayerRef.current.getTime());
                    const qs = [...questions];
                    qs[idx].time = time;
                    setQuestions(qs);
                }
            };

            const handleTestAnswer = (correct, index) => {
                if (isProcessing) return;
                setIsProcessing(true);

                if (correct) {
                    setFeedback('correct');
                    speak("–ë—Ä–∞–≤–æ! –ü—Ä–∞–≤–∏–ª–Ω–æ.");
                    setTimeout(() => {
                        setFeedback(null);
                        setActiveQ(null);
                        setWrongAttempts([]);
                        setAnsweredCount(prev => prev + 1);
                        setIsProcessing(false);
                        playerRef.current?.play();
                    }, 2000);
                } else {
                    setFeedback('wrong');
                    speak("–û–ø–∏—Ç–∞–π –æ—Ç–Ω–æ–≤–æ.");
                    setWrongAttempts(prev => [...prev, index]);
                    setTimeout(() => {
                        setFeedback(null);
                        setIsProcessing(false);
                    }, 1500);
                }
            };

            const handleTaskComplete = () => {
                setFeedback('correct');
                speak("–ë—Ä–∞–≤–æ! –í—Å–∏—á–∫–æ –µ —Ç–æ—á–Ω–æ.");
                setTimeout(() => {
                    setFeedback(null);
                    setActiveQ(null);
                    setAnsweredCount(prev => prev + 1);
                    playerRef.current?.play();
                }, 2000);
            };

            const addQuestion = (type) => {
                let newQ = { id: Date.now(), type, time: 0 };
                if (type === 'single') {
                    newQ = { ...newQ, text: '–ö–æ–µ –µ —Ç–æ–≤–∞?', options: ['–û—Ç–≥–æ–≤–æ—Ä 1', '–û—Ç–≥–æ–≤–æ—Ä 2'], correct: 0 };
                } else if (type === 'label') {
                    newQ = { ...newQ, text: '–ü–æ—Å—Ç–∞–≤–∏ –Ω–∞ –ø—Ä–∞–≤–∏–ª–Ω–∏—Ç–µ –º–µ—Å—Ç–∞', dropZones: [{ id: 1, text: '–ï—Ç–∏–∫–µ—Ç 1', x: 30, y: 50 }, { id: 2, text: '–ï—Ç–∏–∫–µ—Ç 2', x: 70, y: 50 }] };
                } else if (type === 'binary') {
                    newQ = { ...newQ, text: '–í—è—Ä–Ω–æ –ª–∏ –µ, —á–µ...?', correct: true };
                } else if (type === 'emotion') {
                    newQ = { ...newQ, text: '–ö–∞–∫ —Å–µ —á—É–≤—Å—Ç–≤–∞ –≥–µ—Ä–æ—è—Ç?', options: ['üòÄ –©–∞—Å—Ç–ª–∏–≤', 'üò¢ –¢—ä–∂–µ–Ω', 'üò° –Ø–¥–æ—Å–∞–Ω', 'üò® –£–ø–ª–∞—à–µ–Ω'], correct: 0 };
                } else if (type === 'sequence') {
                    newQ = { ...newQ, text: '–ü–æ–¥—Ä–µ–¥–∏ –ø–æ —Ä–µ–¥ –Ω–∞ —Å–ª—É—á–≤–∞–Ω–µ', items: ['–ü—ä—Ä–≤–æ', '–í—Ç–æ—Ä–æ', '–¢—Ä–µ—Ç–æ'] };
                }
                setQuestions([...questions, newQ]);
                if (type === 'label') setEditLabelModeId(newQ.id);
            };

            return (
                <div className={`min-h-screen transition-all ${theme} ${fontSize === 'big' ? 'big-font' : ''}`}>
                    <nav className="bg-white border-b p-3 flex justify-between items-center sticky top-0 z-50 shadow-sm">
                        <div className="flex gap-2">
                            <button onClick={() => setTheme(theme === 'default' ? 'sop-soft' : theme === 'sop-soft' ? 'sop-high-contrast' : 'default')} className="p-3 bg-slate-100 rounded-full hover:bg-slate-200 transition-all">
                                <Icons.Settings />
                            </button>
                            <button onClick={() => setFontSize(fontSize === 'normal' ? 'big' : 'normal')} className="w-12 h-12 flex items-center justify-center font-bold bg-slate-100 rounded-full">
                                {fontSize === 'normal' ? 'A+' : 'A-'}
                            </button>
                        </div>
                        <div className="flex gap-1 bg-slate-100 p-1 rounded-2xl">
                            <button onClick={() => { setView('student'); setEditLabelModeId(null); }} className={`px-5 py-2 rounded-xl font-bold transition-all ${view === 'student' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>–£—á–µ–Ω–∏–∫</button>
                            <button onClick={() => setView('teacher')} className={`px-5 py-2 rounded-xl font-bold transition-all ${view === 'teacher' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>–£—á–∏—Ç–µ–ª</button>
                        </div>
                    </nav>

                    <main className="max-w-6xl mx-auto p-4 sm:p-6">
                        {view === 'student' ? (
                            <div className="animate-fade-in space-y-6 max-w-4xl mx-auto">
                                {/* –ü—Ä–æ–≥—Ä–µ—Å –±–∞—Ä */}
                                {questions.length > 0 && (
                                    <div className="flex items-center gap-3 bg-white p-4 rounded-3xl shadow-sm border-2 border-slate-100">
                                        <span className="font-bold text-slate-500 uppercase tracking-wider text-xs sm:text-sm">–ü—Ä–æ–≥—Ä–µ—Å:</span>
                                        <div className="flex-1 bg-slate-100 h-6 rounded-full overflow-hidden shadow-inner relative">
                                            <div className="bg-yellow-400 h-full transition-all duration-1000 ease-out" style={{ width: `${(answeredCount / questions.length) * 100}%` }}></div>
                                        </div>
                                        <span className="font-black text-yellow-500 flex items-center gap-1 text-lg">
                                            {answeredCount} / {questions.length} <Icons.Star className="w-6 h-6 text-yellow-400 drop-shadow-sm" />
                                        </span>
                                    </div>
                                )}

                                <div className="aspect-video relative rounded-3xl overflow-hidden shadow-2xl bg-black">
                                    <MediaPlayer ref={playerRef} url={videoUrl} onReady={() => {}} />
                                    
                                    {/* --- –ò–ù–¢–ï–†–§–ï–ô–° –ó–ê –í–™–ü–†–û–°–ò–¢–ï –ü–†–ò –£–ß–ï–ù–ò–ö–ê --- */}
                                    
                                    {/* –¢–ò–ü: –¢–ï–°–¢ (–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω –∏–∑–±–æ—Ä) */}
                                    {activeQ && activeQ.type === 'single' && (
                                        <div className="absolute inset-0 bg-white/95 flex items-center justify-center p-6 z-40 animate-fade-in overflow-y-auto">
                                            <div className="w-full max-w-3xl text-center py-8">
                                                <button onClick={() => speak(activeQ.text)} className="p-5 bg-blue-100 text-blue-600 rounded-full animate-bounce-short mb-6 shadow-md"><Icons.Speaker /></button>
                                                <h2 className="text-2xl sm:text-4xl font-black mb-10 leading-tight px-4">{activeQ.text}</h2>
                                                
                                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 px-2">
                                                    {activeQ.options.map((opt, i) => {
                                                        if (wrongAttempts.includes(i)) return null; 
                                                        return (
                                                            <button key={i} onClick={() => handleTestAnswer(i === activeQ.correct, i)} disabled={isProcessing} className="p-4 sm:p-6 bg-white border-4 border-slate-100 rounded-3xl text-xl font-bold hover:border-blue-500 flex flex-col items-center justify-center gap-4 group transition-transform active:scale-95 shadow-sm hover:shadow-xl">
                                                                {isImageUrl(opt) ? (
                                                                    <div className="w-full h-32 sm:h-48 relative rounded-xl overflow-hidden bg-slate-50 flex items-center justify-center mb-2">
                                                                        <img src={opt} className="max-w-full max-h-full object-contain mix-blend-multiply" onError={(e) => e.target.style.display='none'} />
                                                                    </div>
                                                                ) : (
                                                                    <span className="text-2xl sm:text-3xl text-center break-words w-full px-2">{opt}</span>
                                                                )}
                                                                <div className="flex items-center justify-between w-full mt-auto pt-4 border-t-2 border-slate-50">
                                                                    <span className="text-3xl bg-slate-50 w-12 h-12 rounded-full flex items-center justify-center shadow-inner">{['üçé', 'üîµ', '‚≠êÔ∏è', 'üçÄ'][i] || 'üéØ'}</span>
                                                                    <button onClick={(e) => { e.stopPropagation(); speak(isImageUrl(opt) ? "–ö–∞—Ä—Ç–∏–Ω–∫–∞" : opt); }} className="p-3 text-slate-400 bg-slate-100 rounded-full group-hover:text-blue-500 transition-colors"><Icons.Speaker /></button>
                                                                </div>
                                                            </button>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* –¢–ò–ü: –ë–ò–ù–ê–†–ï–ù –ò–ó–ë–û–† (–î–∞/–ù–µ) */}
                                    {activeQ && activeQ.type === 'binary' && (
                                        <div className="absolute inset-0 bg-white/95 flex flex-col items-center justify-center p-6 z-40 animate-fade-in overflow-y-auto">
                                            <div className="w-full max-w-4xl text-center py-8">
                                                <button onClick={() => speak(activeQ.text)} className="p-5 bg-blue-100 text-blue-600 rounded-full animate-bounce-short mb-8 shadow-md"><Icons.Speaker /></button>
                                                <h2 className="text-3xl sm:text-5xl font-black mb-12 leading-tight px-4">{activeQ.text}</h2>
                                                <div className="flex justify-center gap-6 sm:gap-12 px-2">
                                                    {!wrongAttempts.includes('true') && (
                                                        <button onClick={() => handleTestAnswer(activeQ.correct === true, 'true')} disabled={isProcessing} className="w-40 h-40 sm:w-56 sm:h-56 bg-white border-8 border-green-400 rounded-[3rem] text-xl font-bold hover:bg-green-50 flex flex-col items-center justify-center gap-2 group transition-transform active:scale-95 shadow-xl">
                                                            <span className="text-6xl sm:text-8xl group-hover:scale-110 transition-transform group-hover:-rotate-6 drop-shadow-md">üëç</span>
                                                            <span className="text-2xl sm:text-4xl font-black text-green-600 mt-2">–î–ê</span>
                                                        </button>
                                                    )}
                                                    {!wrongAttempts.includes('false') && (
                                                        <button onClick={() => handleTestAnswer(activeQ.correct === false, 'false')} disabled={isProcessing} className="w-40 h-40 sm:w-56 sm:h-56 bg-white border-8 border-red-400 rounded-[3rem] text-xl font-bold hover:bg-red-50 flex flex-col items-center justify-center gap-2 group transition-transform active:scale-95 shadow-xl">
                                                            <span className="text-6xl sm:text-8xl group-hover:scale-110 transition-transform group-hover:rotate-6 drop-shadow-md">üëé</span>
                                                            <span className="text-2xl sm:text-4xl font-black text-red-600 mt-2">–ù–ï</span>
                                                        </button>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* –¢–ò–ü: –ï–ú–û–¶–ò–Ø */}
                                    {activeQ && activeQ.type === 'emotion' && (
                                        <div className="absolute inset-0 bg-white/95 flex items-center justify-center p-6 z-40 animate-fade-in overflow-y-auto">
                                            <div className="w-full max-w-4xl text-center py-8">
                                                <button onClick={() => speak(activeQ.text)} className="p-5 bg-blue-100 text-blue-600 rounded-full animate-bounce-short mb-6 shadow-md"><Icons.Speaker /></button>
                                                <h2 className="text-2xl sm:text-5xl font-black mb-10 leading-tight px-4">{activeQ.text}</h2>
                                                <div className="grid grid-cols-2 gap-4 sm:gap-8 px-2 max-w-2xl mx-auto">
                                                    {activeQ.options.map((opt, i) => {
                                                        if (wrongAttempts.includes(i)) return null; 
                                                        const emoji = Array.from(opt)[0];
                                                        const text = Array.from(opt).slice(1).join('').trim();
                                                        return (
                                                            <button key={i} onClick={() => handleTestAnswer(i === activeQ.correct, i)} disabled={isProcessing} className="p-6 sm:p-10 bg-white border-4 border-slate-100 rounded-[2rem] text-xl font-bold hover:border-blue-500 flex flex-col items-center justify-center gap-4 group transition-transform active:scale-95 shadow-sm hover:shadow-xl">
                                                                <span className="text-6xl sm:text-[6rem] group-hover:scale-110 transition-transform drop-shadow-md">{emoji}</span>
                                                                <span className="text-2xl sm:text-3xl text-slate-700">{text}</span>
                                                            </button>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* –¢–ò–ü–û–í–ï –° –í–õ–ê–ß–ï–ù–ï (Label / Sequence) */}
                                    {activeQ && activeQ.type === 'label' && <LabelTaskOverlay question={activeQ} onComplete={handleTaskComplete} />}
                                    {activeQ && activeQ.type === 'sequence' && <SequenceTaskOverlay question={activeQ} onComplete={handleTaskComplete} />}

                                    {/* –£–ù–ò–í–ï–†–°–ê–õ–ù–ê –û–ë–†–ê–¢–ù–ê –í–†–™–ó–ö–ê */}
                                    {feedback && (
                                        <div className="absolute inset-0 flex items-center justify-center z-50 bg-white/80 backdrop-blur-sm">
                                            <div className="text-center scale-125 animate-pop">
                                                <div className={`p-8 rounded-full mb-4 inline-block shadow-inner ${feedback === 'correct' ? 'bg-green-100' : 'bg-red-100'}`}>
                                                    {feedback === 'correct' ? <Icons.Check /> : <Icons.X />}
                                                </div>
                                                <h2 className={`text-4xl font-black ${feedback === 'correct' ? 'text-green-600' : 'text-red-600'}`}>
                                                    {feedback === 'correct' ? '–ë–†–ê–í–û!' : '–û–ü–ò–¢–ê–ô –ü–ê–ö'}
                                                </h2>
                                            </div>
                                        </div>
                                    )}
                                </div>
                                {!videoUrl && <div className="text-center py-24 bg-white rounded-3xl border-4 border-dashed border-slate-200 text-slate-300 font-black text-xl">–ù—è–º–∞ –∑–∞—Ä–µ–¥–µ–Ω —Ç–µ—Å—Ç</div>}
                            </div>
                        ) : (
                            /* –†–ï–ñ–ò–ú –£–ß–ò–¢–ï–õ */
                            !isAuth ? (
                                <div className="max-w-md mx-auto p-10 bg-white rounded-3xl shadow-2xl text-center border mt-10">
                                    <h2 className="text-2xl font-black mb-6">–í—Ö–æ–¥ –∑–∞ –£—á–∏—Ç–µ–ª</h2>
                                    <input type="password" placeholder="–ü–∞—Ä–æ–ª–∞..." className="w-full p-4 border-2 rounded-2xl mb-6 text-center text-xl outline-none focus:border-blue-500" onChange={e => setPass(e.target.value)} onKeyDown={e => e.key === 'Enter' && (pass === 'vilidaf76' ? setIsAuth(true) : alert('–ì—Ä–µ—à–Ω–∞ –ø–∞—Ä–æ–ª–∞'))} />
                                    <button onClick={() => pass === 'admin' ? setIsAuth(true) : alert('–ì—Ä–µ—à–Ω–∞ –ø–∞—Ä–æ–ª–∞')} className="w-full bg-blue-600 text-white p-5 rounded-2xl font-black text-lg hover:bg-blue-700 shadow-lg shadow-blue-100 transition-all">–í–ª–µ–∑ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏—Ç–µ</button>
                                </div>
                            ) : (
                                <div className="space-y-6 animate-fade-in">
                                    <div className="bg-blue-50 border-2 border-blue-200 p-5 rounded-3xl flex flex-col sm:flex-row justify-between items-center gap-4">
                                        <div className="text-center sm:text-left">
                                            <h3 className="font-black text-blue-800 text-lg">–ì–æ—Ç–æ–≤–∏ –ª–∏ —Å—Ç–µ —Å —Ç–µ—Å—Ç–∞?</h3>
                                            <p className="text-sm text-blue-600">–ö–æ–ø–∏—Ä–∞–π—Ç–µ –ª–∏–Ω–∫–∞ –∏–ª–∏ –∑–∞–ø–∞–∑–µ—Ç–µ —Ñ–∞–π–ª–∞ –∑–∞ –æ–±–º–µ–Ω —Å –∫–æ–ª–µ–≥–∏.</p>
                                        </div>
                                        <div className="flex flex-wrap justify-center sm:justify-end gap-2 w-full sm:w-auto">
                                            <input type="file" accept=".json" style={{ display: 'none' }} ref={fileInputRef} onChange={handleImport} />
                                            <button onClick={() => fileInputRef.current.click()} className="bg-white text-blue-600 border-2 border-blue-600 px-4 py-3 rounded-2xl font-black hover:bg-blue-50 transition-all text-sm shadow-sm flex-1 sm:flex-none">üìÇ –ó–∞—Ä–µ–¥–∏</button>
                                            <button onClick={handleExport} className="bg-white text-blue-600 border-2 border-blue-600 px-4 py-3 rounded-2xl font-black hover:bg-blue-50 transition-all text-sm shadow-sm flex-1 sm:flex-none">üíæ –ó–∞–ø–∞–∑–∏</button>
                                            <button onClick={handleCopyLink} className="bg-blue-600 text-white px-6 py-3 rounded-2xl font-black hover:bg-blue-700 shadow-xl transition-all text-sm w-full sm:w-auto">üîó –ö–æ–ø–∏—Ä–∞–π –ª–∏–Ω–∫</button>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                                        {/* –õ–Ø–í–ê –ö–û–õ–û–ù–ê: –ü–õ–ï–ô–™–† + –†–ï–î–ê–ö–¢–û–† –ù–ê –ó–û–ù–ò */}
                                        <div className="lg:col-span-7 space-y-6">
                                            <div className="bg-white p-6 rounded-3xl border shadow-xl">
                                                <h2 className="text-xl font-black text-slate-800 mb-4">1. –í–∏–¥–µ–æ –∏ –ü–æ–∑–∏—Ü–∏–∏</h2>
                                                <input placeholder="https://www.youtube.com/watch?v=..." className="w-full p-4 border-2 rounded-2xl mb-6 font-mono text-sm focus:border-blue-500 outline-none" value={videoUrl} onChange={e => { setVideoUrl(e.target.value); setPlayerIsReady(false); }} />
                                                <div ref={teacherVideoContainerRef} className={`aspect-video relative rounded-2xl overflow-hidden bg-slate-100 ${editLabelModeId ? 'ring-8 ring-blue-500 ring-opacity-50' : ''}`}>
                                                    <MediaPlayer ref={teacherPlayerRef} url={videoUrl} onReady={() => setPlayerIsReady(true)} />
                                                    
                                                    {editLabelModeId && (
                                                        <div className="absolute inset-0 bg-black/30 z-20">
                                                            {questions.find(q => q.id === editLabelModeId)?.dropZones.map(zone => (
                                                                <DraggableTeacherZone 
                                                                    key={zone.id} zone={zone} videoContainerRef={teacherVideoContainerRef}
                                                                    onUpdate={(updatedZone) => {
                                                                        const qs = [...questions];
                                                                        const qIdx = qs.findIndex(q => q.id === editLabelModeId);
                                                                        const zIdx = qs[qIdx].dropZones.findIndex(z => z.id === zone.id);
                                                                        qs[qIdx].dropZones[zIdx] = updatedZone;
                                                                        setQuestions(qs);
                                                                    }}
                                                                />
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                                
                                                {editLabelModeId ? (
                                                    <div className="mt-4 p-4 bg-yellow-50 rounded-2xl border border-yellow-200 text-center animate-pulse">
                                                        <p className="font-bold text-yellow-800">–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ü–∏—è –Ω–∞ –∑–æ–Ω–∏ –∞–∫—Ç–∏–≤–µ–Ω!</p>
                                                        <p className="text-xs text-yellow-700 mt-1">–•–≤–∞–Ω–µ—Ç–µ –∏ –ø—Ä–µ–º–µ—Å—Ç–µ—Ç–µ –µ—Ç–∏–∫–µ—Ç–∏—Ç–µ –≤—ä—Ä—Ö—É –≤–∏–¥–µ–æ—Ç–æ, –∑–∞ –¥–∞ –Ω–∞–≥–ª–∞—Å–∏—Ç–µ –∫—ä–¥–µ –¥–∞ –±—ä–¥–∞—Ç –±–µ–ª–∏—Ç–µ –ø–æ–ª–µ—Ç–∞.</p>
                                                        <button onClick={() => setEditLabelModeId(null)} className="mt-3 bg-yellow-400 text-yellow-900 px-6 py-2 rounded-xl font-bold shadow-sm">–ì–æ—Ç–æ–≤–æ</button>
                                                    </div>
                                                ) : (
                                                    <div className="mt-4 p-4 bg-blue-50 rounded-2xl border border-blue-100">
                                                        <p className="text-xs text-blue-600">üí° <b>–°–Ω–∏–º–∫–∏:</b> –ü–æ—Å—Ç–∞–≤–µ—Ç–µ –ª–∏–Ω–∫ (http...) –∫—ä–º —Å–Ω–∏–º–∫–∞ –¥–∏—Ä–µ–∫—Ç–Ω–æ –≤ –ø–æ–ª–µ—Ç–æ –∑–∞ –æ—Ç–≥–æ–≤–æ—Ä/–µ—Ç–∏–∫–µ—Ç, –∑–∞ –¥–∞ –ø–æ–∫–∞–∂–µ—Ç–µ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç.</p>
                                                    </div>
                                                )}
                                            </div>
                                        </div>

                                        {/* –î–Ø–°–ù–ê –ö–û–õ–û–ù–ê: –í–™–ü–†–û–°–ò */}
                                        <div className="lg:col-span-5 space-y-6">
                                            <div className="bg-white p-6 rounded-3xl border shadow-xl flex flex-col h-full max-h-[85vh]">
                                                <div className="mb-6">
                                                    <h2 className="text-xl font-black mb-3">2. –î–æ–±–∞–≤–∏ –∑–∞–¥–∞—á–∏</h2>
                                                    <div className="flex flex-wrap gap-2">
                                                        <button onClick={() => addQuestion('single')} className="bg-blue-600 text-white px-3 py-2 rounded-xl font-bold text-xs hover:bg-blue-700 shadow-md">üìù –¢–µ—Å—Ç</button>
                                                        <button onClick={() => addQuestion('binary')} className="bg-emerald-600 text-white px-3 py-2 rounded-xl font-bold text-xs hover:bg-emerald-700 shadow-md">üëç –î–∞/–ù–µ</button>
                                                        <button onClick={() => addQuestion('emotion')} className="bg-amber-500 text-white px-3 py-2 rounded-xl font-bold text-xs hover:bg-amber-600 shadow-md">üòÄ –ï–º–æ—Ü–∏—è</button>
                                                        <button onClick={() => addQuestion('label')} className="bg-purple-600 text-white px-3 py-2 rounded-xl font-bold text-xs hover:bg-purple-700 shadow-md">üìç –ü–æ–∑–∏—Ü–∏–∏</button>
                                                        <button onClick={() => addQuestion('sequence')} className="bg-indigo-600 text-white px-3 py-2 rounded-xl font-bold text-xs hover:bg-indigo-700 shadow-md">üî¢ –†–µ–¥</button>
                                                    </div>
                                                </div>
                                                
                                                <div className="space-y-6 overflow-y-auto pr-2 flex-1 scrollbar-hide">
                                                    {questions.map((q, idx) => (
                                                        <div key={q.id} className={`p-5 border-2 rounded-3xl bg-slate-50 relative transition-all ${editLabelModeId === q.id ? 'border-blue-500 shadow-lg' : 'hover:border-slate-300'}`}>
                                                            <button onClick={() => setQuestions(questions.filter(x => x.id !== q.id))} className="absolute -top-2 -right-2 bg-red-500 text-white w-7 h-7 rounded-full font-bold shadow-lg flex items-center justify-center hover:bg-red-600">√ó</button>
                                                            
                                                            <div className="flex gap-2 mb-4">
                                                                <div className="relative w-28 shrink-0">
                                                                    <label className="text-[10px] font-bold text-slate-400 block mb-1 uppercase">–°–µ–∫.</label>
                                                                    <input type="number" className="w-full p-2 border rounded-xl font-bold pr-8 text-sm" value={q.time} onChange={e => {
                                                                        const qs = [...questions]; qs[idx].time = parseInt(e.target.value) || 0; setQuestions(qs);
                                                                    }} />
                                                                    <button onClick={() => captureTime(idx)} className="absolute right-1 bottom-1 p-1.5 bg-blue-100 text-blue-600 rounded-lg"><Icons.Clock /></button>
                                                                </div>
                                                                <div className="flex-1">
                                                                    <label className="text-[10px] font-bold text-slate-400 block mb-1 uppercase">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è / –í—ä–ø—Ä–æ—Å</label>
                                                                    <input className="w-full p-2 border rounded-xl font-bold text-sm" value={q.text} onChange={e => {
                                                                        const qs = [...questions]; qs[idx].text = e.target.value; setQuestions(qs);
                                                                    }} />
                                                                </div>
                                                            </div>

                                                            {/* –¢–ò–ü: –¢–ï–°–¢ –° –ò–ó–ë–û–† */}
                                                            {q.type === 'single' && (
                                                                <div>
                                                                    <label className="text-[10px] font-bold text-slate-400 block mb-2 uppercase">–û—Ç–≥–æ–≤–æ—Ä–∏ (–º–∞—Ä–∫–∏—Ä–∞–π—Ç–µ –≤–µ—Ä–Ω–∏—è)</label>
                                                                    <div className="grid grid-cols-1 gap-2">
                                                                        {q.options.map((opt, oi) => (
                                                                            <div key={oi} className="relative group/opt">
                                                                                <input className={`w-full p-2 border-2 rounded-lg text-xs pr-8 ${q.correct === oi ? 'border-green-500 bg-green-50' : 'focus:border-blue-300'}`} placeholder="–¢–µ–∫—Å—Ç –∏–ª–∏ –ª–∏–Ω–∫ –∫—ä–º —Å–Ω–∏–º–∫–∞" value={opt} onChange={e => {
                                                                                    const qs = [...questions]; qs[idx].options[oi] = e.target.value; setQuestions(qs);
                                                                                }} />
                                                                                <input type="radio" name={`q-${q.id}`} checked={q.correct === oi} onChange={() => {
                                                                                    const qs = [...questions]; qs[idx].correct = oi; setQuestions(qs);
                                                                                }} className="absolute right-2 top-1/2 -translate-y-1/2 accent-green-600 w-4 h-4" />
                                                                                {q.options.length > 2 && (
                                                                                    <button onClick={() => {
                                                                                        const qs = [...questions]; qs[idx].options.splice(oi, 1);
                                                                                        if (qs[idx].correct >= qs[idx].options.length) qs[idx].correct = 0; setQuestions(qs);
                                                                                    }} className="absolute -top-2 -right-2 bg-red-100 text-red-600 rounded-full w-5 h-5 flex items-center justify-center text-[10px] font-bold opacity-0 group-hover/opt:opacity-100">√ó</button>
                                                                                )}
                                                                            </div>
                                                                        ))}
                                                                    </div>
                                                                    {q.options.length < 4 && <button onClick={() => { const qs = [...questions]; qs[idx].options.push(`–û—Ç–≥–æ–≤–æ—Ä ${qs[idx].options.length + 1}`); setQuestions(qs); }} className="mt-2 text-[10px] font-bold text-blue-600 bg-blue-50 px-3 py-1.5 rounded-lg hover:bg-blue-100">+ –í–∞—Ä–∏–∞–Ω—Ç</button>}
                                                                </div>
                                                            )}

                                                            {/* –¢–ò–ü: –î–ê / –ù–ï */}
                                                            {q.type === 'binary' && (
                                                                <div>
                                                                    <label className="text-[10px] font-bold text-slate-400 block mb-2 uppercase">–í–µ—Ä–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä</label>
                                                                    <div className="flex gap-4">
                                                                        <button onClick={() => { const qs = [...questions]; qs[idx].correct = true; setQuestions(qs); }} className={`flex-1 p-3 rounded-xl border-4 font-black flex items-center justify-center gap-2 transition-all ${q.correct === true ? 'bg-green-100 border-green-500 text-green-700' : 'bg-white border-slate-200 text-slate-400'}`}>üëç –î–ê</button>
                                                                        <button onClick={() => { const qs = [...questions]; qs[idx].correct = false; setQuestions(qs); }} className={`flex-1 p-3 rounded-xl border-4 font-black flex items-center justify-center gap-2 transition-all ${q.correct === false ? 'bg-red-100 border-red-500 text-red-700' : 'bg-white border-slate-200 text-slate-400'}`}>üëé –ù–ï</button>
                                                                    </div>
                                                                </div>
                                                            )}

                                                            {/* –¢–ò–ü: –ï–ú–û–¶–ò–ò */}
                                                            {q.type === 'emotion' && (
                                                                <div>
                                                                    <label className="text-[10px] font-bold text-slate-400 block mb-2 uppercase">–ò–∑–±–µ—Ä–µ—Ç–µ –ø—Ä–∞–≤–∏–ª–Ω–∞—Ç–∞ –µ–º–æ—Ü–∏—è</label>
                                                                    <div className="grid grid-cols-2 gap-2">
                                                                        {q.options.map((opt, oi) => (
                                                                            <button key={oi} onClick={() => { const qs = [...questions]; qs[idx].correct = oi; setQuestions(qs); }} className={`p-2 rounded-xl border-2 font-bold text-sm flex items-center gap-2 transition-all ${q.correct === oi ? 'bg-green-100 border-green-500 text-green-800' : 'bg-white border-slate-200 text-slate-600 hover:border-blue-300'}`}>
                                                                                <input type="radio" checked={q.correct === oi} readOnly className="accent-green-600 w-4 h-4 shrink-0" />
                                                                                {opt}
                                                                            </button>
                                                                        ))}
                                                                    </div>
                                                                </div>
                                                            )}

                                                            {/* –¢–ò–ü: –í–õ–ê–ß–ï–ù–ï (Label) */}
                                                            {q.type === 'label' && (
                                                                <div>
                                                                    <div className="flex justify-between items-end mb-2">
                                                                        <label className="text-[10px] font-bold text-slate-400 uppercase">–ï—Ç–∏–∫–µ—Ç–∏ –∑–∞ –≤–ª–∞—á–µ–Ω–µ</label>
                                                                        <button onClick={() => setEditLabelModeId(editLabelModeId === q.id ? null : q.id)} className={`text-xs font-bold px-3 py-1.5 rounded-lg transition-all ${editLabelModeId === q.id ? 'bg-yellow-400 text-yellow-900 shadow-sm' : 'bg-blue-100 text-blue-700 hover:bg-blue-200'}`}>
                                                                            {editLabelModeId === q.id ? '‚úÖ –ó–∞–ø–∞–∑–∏ –ø–æ–∑–∏—Ü–∏–∏' : 'üìç –ù–∞–≥–ª–∞—Å–∏ –≤—ä—Ä—Ö—É –≤–∏–¥–µ–æ—Ç–æ'}
                                                                        </button>
                                                                    </div>
                                                                    <div className="space-y-2">
                                                                        {q.dropZones.map((zone, zi) => (
                                                                            <div key={zone.id} className="relative flex gap-2">
                                                                                <input className="w-full p-2 border-2 rounded-lg text-xs border-purple-200 focus:border-purple-400" placeholder="–¢–µ–∫—Å—Ç –∏–ª–∏ –ª–∏–Ω–∫ –∫—ä–º —Å–Ω–∏–º–∫–∞..." value={zone.text} onChange={e => {
                                                                                    const qs = [...questions]; qs[idx].dropZones[zi].text = e.target.value; setQuestions(qs);
                                                                                }} />
                                                                                <button onClick={() => {
                                                                                    const qs = [...questions]; qs[idx].dropZones.splice(zi, 1); setQuestions(qs);
                                                                                }} className="bg-red-50 text-red-500 px-2 rounded-lg hover:bg-red-100">√ó</button>
                                                                            </div>
                                                                        ))}
                                                                    </div>
                                                                    {q.dropZones.length < 6 && <button onClick={() => { const qs = [...questions]; qs[idx].dropZones.push({ id: Date.now(), text: '–ù–æ–≤', x: 50, y: 50 }); setQuestions(qs); }} className="mt-2 text-[10px] font-bold text-purple-600 bg-purple-50 px-3 py-1.5 rounded-lg hover:bg-purple-100">+ –î–æ–±–∞–≤–∏ –µ—Ç–∏–∫–µ—Ç</button>}
                                                                </div>
                                                            )}

                                                            {/* –¢–ò–ü: –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–ù–û–°–¢ (Sequence) */}
                                                            {q.type === 'sequence' && (
                                                                <div>
                                                                    <label className="text-[10px] font-bold text-slate-400 block mb-2 uppercase">–ü—Ä–∞–≤–∏–ª–µ–Ω —Ä–µ–¥ (1 ‚ûû 2 ‚ûû 3)</label>
                                                                    <div className="space-y-2">
                                                                        {q.items.map((item, ii) => (
                                                                            <div key={ii} className="flex items-center gap-2 group/seq">
                                                                                <div className="w-6 h-6 bg-indigo-100 text-indigo-800 rounded-full flex items-center justify-center font-black text-xs shrink-0">{ii + 1}</div>
                                                                                <input className="w-full p-2 border-2 border-indigo-100 rounded-lg text-xs focus:border-indigo-400" placeholder="–¢–µ–∫—Å—Ç –∏–ª–∏ –ª–∏–Ω–∫ –∫—ä–º —Å–Ω–∏–º–∫–∞" value={item} onChange={e => {
                                                                                    const qs = [...questions]; qs[idx].items[ii] = e.target.value; setQuestions(qs);
                                                                                }} />
                                                                                {q.items.length > 2 && (
                                                                                    <button onClick={() => {
                                                                                        const qs = [...questions]; qs[idx].items.splice(ii, 1); setQuestions(qs);
                                                                                    }} className="bg-red-50 text-red-500 w-8 h-8 rounded-lg flex items-center justify-center hover:bg-red-100 opacity-0 group-hover/seq:opacity-100 transition-opacity">√ó</button>
                                                                                )}
                                                                            </div>
                                                                        ))}
                                                                    </div>
                                                                    {q.items.length < 5 && <button onClick={() => { const qs = [...questions]; qs[idx].items.push(`–°—Ç—ä–ø–∫–∞ ${qs[idx].items.length + 1}`); setQuestions(qs); }} className="mt-3 text-[10px] font-bold text-indigo-600 bg-indigo-50 px-3 py-1.5 rounded-lg hover:bg-indigo-100">+ –î–æ–±–∞–≤–∏ —Å—Ç—ä–ø–∫–∞</button>}
                                                                </div>
                                                            )}
                                                        </div>
                                                    ))}
                                                    {questions.length === 0 && <div className="text-center py-20 border-2 border-dashed rounded-3xl text-slate-400 font-bold italic">–ù—è–º–∞ –∑–∞–¥–∞—á–∏.<br/><span className="text-xs">–ò–∑–±–µ—Ä–µ—Ç–µ –±—É—Ç–æ–Ω –æ—Ç –º–µ–Ω—é—Ç–æ –≥–æ—Ä–µ.</span></div>}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )
                        )}
                    </main>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>

</html>

